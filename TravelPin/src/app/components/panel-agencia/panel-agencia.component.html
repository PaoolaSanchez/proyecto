<div class="panel-agencia">
  <!-- LOGIN -->
  <div *ngIf="!loggedIn" class="login-container">
    <div class="login-card">
      <h1>ğŸ¢ Panel de Agencia</h1>
      <p>Inicia sesiÃ³n para gestionar tus paquetes de viaje</p>
      
      <form (ngSubmit)="login()" class="login-form">
        <div class="form-group">
          <label>Email</label>
          <input 
            type="email" 
            [(ngModel)]="loginData.email" 
            name="email"
            required
            placeholder="tu@agencia.com">
        </div>
        
        <div class="form-group">
          <label>ContraseÃ±a</label>
          <input 
            type="password" 
            [(ngModel)]="loginData.password" 
            name="password"
            required
            placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
        </div>
        
        <button type="submit" class="btn-primary">Iniciar SesiÃ³n</button>
      </form>
    </div>
  </div>

  <!-- PANEL PRINCIPAL -->
  <div *ngIf="loggedIn" class="dashboard">
    <!-- Header -->
    <header class="dashboard-header">
      <div class="header-content">
        <div>
          <h1>{{ agencia?.nombre }}</h1>
          <p class="subtitle">Panel de AdministraciÃ³n</p>
        </div>
        <button (click)="logout()" class="btn-secondary">
          ğŸšª Cerrar SesiÃ³n
        </button>
      </div>
    </header>

    <!-- Contenido -->
    <div class="dashboard-content">
      <!-- Lista de Paquetes -->
      <div class="paquetes-section" *ngIf="!mostrarFormulario">
        <div class="section-header">
          <h2>ğŸ“¦ Mis Paquetes de Viaje</h2>
          <button (click)="abrirFormulario()" class="btn-primary">
            â• Nuevo Paquete
          </button>
        </div>

        <!-- Filtros -->
        <div class="filtros">
          <input 
            type="text" 
            [(ngModel)]="busqueda" 
            placeholder="ğŸ” Buscar paquetes..."
            class="input-busqueda">
          
          <select [(ngModel)]="filtroDestino" class="select-filtro">
            <option [ngValue]="null">ğŸŒ Todos los destinos</option>
            <option *ngFor="let destino of destinosDisponibles" [ngValue]="destino.id">
              {{ destino.nombre }}, {{ destino.pais }}
            </option>
          </select>
        </div>

        <!-- Grid de Paquetes -->
        <div class="paquetes-grid">
          <div *ngFor="let paquete of paquetesFiltrados" class="paquete-card">
            <!-- Destinos -->
            <div class="destinos-badge">
              <span *ngFor="let destino of paquete.destinosCompletos" class="badge">
                ğŸ“ {{ destino.nombre }}
              </span>
            </div>

            <h3>{{ paquete.nombre }}</h3>
            <p class="precio">${{ paquete.precio | number }}</p>
            <p class="duracion">â±ï¸ {{ paquete.duracion }}</p>
            
            <div class="incluye-preview">
              <strong>âœ¨ Incluye:</strong>
              <ul>
                <li *ngFor="let item of paquete.incluye.slice(0, 3)">{{ item }}</li>
                <li *ngIf="paquete.incluye.length > 3">
                  +{{ paquete.incluye.length - 3 }} mÃ¡s...
                </li>
              </ul>
            </div>

            <div *ngIf="paquete.itinerario.length > 0" class="itinerario-preview">
              <strong>ğŸ—“ï¸ Itinerario:</strong>
              <p>{{ paquete.itinerario.length }} dÃ­as planificados</p>
            </div>
            
            <div class="card-actions">
              <button (click)="editarPaquete(paquete)" class="btn-edit">
                âœï¸ Editar
              </button>
              <button (click)="eliminarPaquete(paquete.id)" class="btn-delete">
                ğŸ—‘ï¸ Eliminar
              </button>
            </div>
          </div>

          <div *ngIf="paquetesFiltrados.length === 0 && paquetes.length > 0" class="empty-state">
            <p>ğŸ” No se encontraron paquetes con esos filtros</p>
          </div>

          <div *ngIf="paquetes.length === 0" class="empty-state">
            <div class="empty-icon">ğŸ“¦</div>
            <p>No tienes paquetes aÃºn</p>
            <p class="empty-subtitle">Crea tu primer paquete de viaje para empezar</p>
            <button (click)="abrirFormulario()" class="btn-primary">
              â• Crear Primer Paquete
            </button>
          </div>
        </div>
      </div>

      <!-- Formulario de Paquete -->
      <div class="form-container" *ngIf="mostrarFormulario">
        <div class="form-header">
          <h2>{{ editandoPaquete ? 'âœï¸ Editar Paquete' : 'â• Nuevo Paquete' }}</h2>
          <button (click)="cerrarFormulario()" class="btn-close">âœ•</button>
        </div>

        <form (ngSubmit)="guardarPaquete()" class="paquete-form">
          
          <!-- SECCIÃ“N: DESTINOS -->
          <div class="form-section destinos-section">
            <h3>ğŸŒ Destinos del Paquete *</h3>
            <p class="section-description">Selecciona los destinos que incluye este paquete</p>
            
            <div class="destinos-grid">
              <div 
                *ngFor="let destino of destinosDisponibles" 
                class="destino-item"
                [class.selected]="esDestinoSeleccionado(destino.id)"
                (click)="toggleDestino(destino.id)">
                <div class="destino-checkbox">
                  <input 
                    type="checkbox" 
                    [checked]="esDestinoSeleccionado(destino.id)"
                    (click)="$event.stopPropagation()">
                </div>
                <div class="destino-info">
                  <img *ngIf="destino.imagen_principal" 
                       [src]="destino.imagen_principal" 
                       [alt]="destino.nombre"
                       class="destino-imagen">
                  <div class="destino-nombre">{{ destino.nombre }}</div>
                  <div class="destino-pais">{{ destino.pais }}</div>
                </div>
              </div>
            </div>

            <div *ngIf="nuevoPaquete.destinos.length === 0" class="warning-message">
              âš ï¸ Debes seleccionar al menos un destino
            </div>

            <div *ngIf="nuevoPaquete.destinos.length > 0" class="selected-destinos">
              <strong>Destinos seleccionados:</strong>
              <span *ngFor="let destinoId of nuevoPaquete.destinos" class="badge-selected">
                {{ getNombreDestino(destinoId) }}
              </span>
            </div>
          </div>

          <!-- SECCIÃ“N: INFORMACIÃ“N BÃSICA -->
          <div class="form-section">
            <h3>ğŸ“‹ InformaciÃ³n BÃ¡sica</h3>
            
            <div class="form-group">
              <label>Nombre del Paquete *</label>
              <input 
                type="text" 
                [(ngModel)]="nuevoPaquete.nombre" 
                name="nombre"
                required
                placeholder="Ej: Tour Completo CancÃºn 5 dÃ­as">
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Precio (MXN) *</label>
                <input 
                  type="number" 
                  [(ngModel)]="nuevoPaquete.precio" 
                  name="precio"
                  required
                  min="0"
                  placeholder="12000">
              </div>

              <div class="form-group">
                <label>DuraciÃ³n *</label>
                <input 
                  type="text" 
                  [(ngModel)]="nuevoPaquete.duracion" 
                  name="duracion"
                  required
                  placeholder="Ej: 5 dÃ­as / 4 noches">
              </div>
            </div>
          </div>

          <!-- SECCIÃ“N: QUÃ‰ INCLUYE -->
          <div class="form-section">
            <h3>âœ¨ Â¿QuÃ© Incluye?</h3>
            
            <div class="add-item">
              <input 
                type="text" 
                [(ngModel)]="nuevoIncluye" 
                name="incluye"
                placeholder="Ej: Hotel 5 estrellas todo incluido"
                (keyup.enter)="agregarIncluye()">
              <button type="button" (click)="agregarIncluye()" class="btn-add">
                + Agregar
              </button>
            </div>

            <ul class="items-list">
              <li *ngFor="let item of nuevoPaquete.incluye; let i = index">
                âœ“ {{ item }}
                <button type="button" (click)="eliminarIncluye(i)" class="btn-remove">
                  âœ•
                </button>
              </li>
            </ul>
          </div>

          <!-- SECCIÃ“N: ITINERARIO -->
          <div class="form-section">
            <h3>ğŸ—“ï¸ Itinerario Detallado</h3>
            
            <div class="add-item itinerario">
              <input 
                type="number" 
                [(ngModel)]="nuevoItinerario.dia" 
                name="dia"
                placeholder="DÃ­a"
                min="1"
                class="dia-input">
              <input 
                type="text" 
                [(ngModel)]="nuevoItinerario.actividades" 
                name="actividades"
                placeholder="Actividades del dÃ­a"
                (keyup.enter)="agregarItinerario()">
              <button type="button" (click)="agregarItinerario()" class="btn-add">
                + Agregar
              </button>
            </div>

            <div class="itinerario-list">
              <div *ngFor="let item of nuevoPaquete.itinerario; let i = index" class="itinerario-item">
                <div class="itinerario-dia">DÃ­a {{ item.dia }}</div>
                <div class="itinerario-actividades">{{ item.actividades }}</div>
                <button type="button" (click)="eliminarItinerario(i)" class="btn-remove">
                  âœ•
                </button>
              </div>
            </div>
          </div>

          <!-- SECCIÃ“N: GASTOS INCLUIDOS -->
          <div class="form-section">
            <h3>ğŸ’° Gastos Incluidos en el Paquete</h3>
            
            <div class="add-item gasto">
              <input 
                type="text" 
                [(ngModel)]="nuevoGasto.concepto" 
                name="concepto"
                placeholder="Concepto (Ej: Transporte aeropuerto)">
              <input 
                type="number" 
                [(ngModel)]="nuevoGasto.monto" 
                name="monto"
                placeholder="Monto"
                min="0"
                class="monto-input">
              <button type="button" (click)="agregarGasto()" class="btn-add">
                + Agregar
              </button>
            </div>

            <div class="gastos-list">
              <div *ngFor="let gasto of nuevoPaquete.gastos; let i = index" class="gasto-item">
                <span>{{ gasto.concepto }}</span>
                <span class="monto">${{ gasto.monto | number }}</span>
                <button type="button" (click)="eliminarGasto(i)" class="btn-remove">
                  âœ•
                </button>
              </div>
              
              <div *ngIf="nuevoPaquete.gastos.length > 0" class="total">
                <strong>Total de Gastos Incluidos:</strong>
                <strong class="monto">${{ getTotalGastos() | number }}</strong>
              </div>
            </div>
          </div>

          <!-- BOTONES DE ACCIÃ“N -->
          <div class="form-actions">
            <button type="button" (click)="cerrarFormulario()" class="btn-secondary">
              Cancelar
            </button>
            <button type="submit" class="btn-primary">
              {{ editandoPaquete ? 'ğŸ’¾ Actualizar' : 'âœ¨ Crear' }} Paquete
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>