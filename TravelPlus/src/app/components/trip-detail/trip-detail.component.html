<!-- Estado de carga -->
<div class="loading-container" *ngIf="!viaje">
  <div class="loading-spinner"></div>
  <p class="loading-text">Cargando viaje...</p>
</div>

<div class="trip-detail-container" *ngIf="viaje">
  
  <!-- Vista Principal del Detalle del Viaje -->
  <div *ngIf="!mostrarGastos && !mostrarMapa">
    <!-- Header -->
    <header class="trip-detail-header">
      <button class="back-btn" (click)="volverAtras()">
        â†
      </button>
      <h1 class="trip-detail-title">{{ viaje.nombre }}</h1>
      <button class="share-btn" (click)="compartir()" *ngIf="esViajeActivo()">
        â†—
      </button>
    </header>

    <!-- Fechas del Viaje -->
    <div class="trip-dates" *ngIf="viaje && viaje.fechaInicio && viaje.fechaFin">
      <div class="date-item">
        <span class="date-icon">ğŸ“…</span>
        <div class="date-info">
          <span class="date-label">Inicio</span>
          <span class="date-value">{{ viaje.fechaInicio }}</span>
        </div>
      </div>
      <div class="date-divider">â†’</div>
      <div class="date-item">
        <span class="date-icon">ğŸ“…</span>
        <div class="date-info">
          <span class="date-label">Fin</span>
          <span class="date-value">{{ viaje.fechaFin }}</span>
        </div>
      </div>
    </div>

    <!-- Banner de Viaje Finalizado -->
    <div *ngIf="!esViajeActivo()" class="banner-finalizado">
      <div class="banner-content">
        <h3 class="banner-title">Este viaje ha finalizado</h3>
        <p class="banner-subtitle">Â¡Califica tu experiencia en los destinos que visitaste!</p>
        <button 
          *ngIf="!viajeCalificado"
          class="btn-calificar" 
          (click)="abrirModalCalificacion()">
          Calificar Destino
        </button>
        <div *ngIf="viajeCalificado" class="calificacion-guardada">
          <div class="estrellas-guardadas">
            <span 
              *ngFor="let estrella of getEstrellas()" 
              class="estrella"
              [class.active]="estrella <= calificacionSeleccionada">
              â˜…
            </span>
          </div>
          <p class="resena-guardada" *ngIf="resenaViaje && resenaViaje.length > 0">{{ resenaViaje }}</p>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <main class="trip-detail-content">
      <!-- Action Buttons - Solo si estÃ¡ activo -->
      <div class="action-buttons" *ngIf="esViajeActivo()">
        <button class="action-btn primary" (click)="verGastos()">
          <span class="action-icon">ğŸ’°</span>
          <span class="action-text">Ver Gastos</span>
        </button>
        <button class="action-btn secondary" (click)="verMapa()">
          <span class="action-icon">ğŸ“</span>
          <span class="action-text">Ver Mapa</span>
        </button>
      </div>

      <!-- BotÃ³n Finalizar Viaje -->
      <div *ngIf="esViajeActivo()" class="finalizar-viaje-section">
        <button class="btn-finalizar-viaje" (click)="finalizarViaje()">
          Marcar viaje como finalizado
        </button>
      </div>

      <!-- Participantes Section -->
      <section class="detail-section">
        <div class="section-header">
          <h2 class="section-title">Participantes ({{ getContadorParticipantes() }})</h2>
          <span *ngIf="!esViajeActivo()" class="badge-readonly">Solo lectura</span>
        </div>

        <div class="participantes-list">
          <div 
            *ngFor="let participante of viaje.participantes"
            class="participante-item">
            <div class="participante-avatar" [style.background-color]="participante.color">
              {{ participante.iniciales }}
            </div>
            <span class="participante-nombre">{{ participante.nombre }}</span>
            <!-- BotÃ³n eliminar solo si el viaje estÃ¡ activo -->
            <button 
              class="btn-delete-mini" 
              (click)="eliminarParticipante(participante)"
              *ngIf="esViajeActivo() && viaje.participantes.length > 1">
              âœ•
            </button>
          </div>
        </div>

        <!-- Agregar Amigo - Solo si estÃ¡ activo -->
        <div class="add-friend-section" *ngIf="esViajeActivo()">
          <div *ngIf="!mostrarAgregarAmigo" class="email-input-container">
            <input 
              type="text" 
              class="email-input" 
              placeholder="Nombre de un amigo"
              readonly
              (click)="mostrarFormularioAmigo()">
            <button class="btn-add-friend" (click)="mostrarFormularioAmigo()">
              â¤
            </button>
          </div>

          <div *ngIf="mostrarAgregarAmigo" class="add-friend-form">
            <input 
              type="text" 
              class="friend-name-input" 
              placeholder="Nombre del amigo"
              [(ngModel)]="nuevoAmigo"
              (keyup.enter)="agregarAmigo()"
              autofocus>
            <div class="form-actions-inline">
              <button class="btn-cancel-inline" (click)="cancelarAgregarAmigo()">
                Cancelar
              </button>
              <button 
                class="btn-add-inline" 
                (click)="agregarAmigo()"
                [disabled]="!nuevoAmigo.trim()">
                Agregar
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- Itinerario Section -->
      <section class="detail-section">
        <div class="section-header">
          <h2 class="section-title">Itinerario ({{ getContadorItinerario() }})</h2>
          <span *ngIf="!esViajeActivo()" class="badge-readonly">Solo lectura</span>
        </div>

        <div *ngIf="viaje.itinerario.length === 0" class="empty-message">
          No hay destinos en el itinerario
        </div>

        <div class="itinerario-list">
          <div 
            *ngFor="let destino of viaje.itinerario"
            class="itinerario-item"
            [class.readonly]="!esViajeActivo()"
            (click)="esViajeActivo() && verDestinoEnItinerario(destino)">
            <img [src]="destino.imagen" [alt]="destino.nombre" class="itinerario-image">
            <div class="itinerario-info">
              <h3 class="itinerario-nombre">{{ destino.nombre }}</h3>
              <p class="itinerario-pais">{{ destino.pais }}</p>
            </div>
            <!-- BotÃ³n eliminar solo si estÃ¡ activo -->
            <button 
              *ngIf="esViajeActivo()"
              class="btn-delete-itinerario" 
              (click)="eliminarDestinoItinerario(destino); $event.stopPropagation()">
              ğŸ—‘ï¸
            </button>
          </div>
        </div>
      </section>

      <!-- Recordatorios Section -->
      <section class="detail-section recordatorios-section">
        <div class="section-header">
          <h2 class="section-title">
            <span class="bell-icon">ğŸ””</span>
            Recordatorios del Viaje
          </h2>
          <span *ngIf="!esViajeActivo()" class="badge-readonly">Solo lectura</span>
        </div>

        <!-- Lista de Recordatorios -->
        <div class="recordatorios-cards">
          <div 
            *ngFor="let recordatorio of recordatoriosOrdenados"
            class="recordatorio-card"
            [class.completed]="recordatorio.completado"
            [class.readonly]="!esViajeActivo()">>
            <div class="recordatorio-left">
              <!-- BotÃ³n check solo funciona si estÃ¡ activo -->
              <button 
                class="btn-check-reminder"
                (click)="esViajeActivo() && toggleRecordatorio(recordatorio)"
                [class.checked]="recordatorio.completado"
                [disabled]="!esViajeActivo()">
                <span *ngIf="recordatorio.completado">âœ“</span>
              </button>
              <div class="recordatorio-text">
                <h3 class="recordatorio-name">{{ recordatorio.titulo }}</h3>
                <p class="recordatorio-time">Vence: {{ recordatorio.fecha }}</p>
              </div>
            </div>
            <div class="recordatorio-right">
              <!-- BotÃ³n eliminar solo si estÃ¡ activo -->
              <button 
                *ngIf="esViajeActivo()"
                class="btn-delete-reminder-icon"
                (click)="eliminarRecordatorio(recordatorio)">
                ğŸ—‘ï¸
              </button>
            </div>
          </div>
        </div>

        <!-- Formulario Agregar Recordatorio - Solo si estÃ¡ activo -->
        <div class="add-recordatorio-form" *ngIf="mostrarFormularioRecordatorio && esViajeActivo()">
          <input 
            type="text" 
            class="recordatorio-input"
            placeholder="Nuevo Recordatorio"
            [(ngModel)]="nuevoRecordatorioTitulo"
            (keyup.enter)="agregarRecordatorio()">
          
          <div class="recordatorio-actions">
            <div class="date-input-wrapper">
              <input 
                type="date" 
                class="recordatorio-date-input"
                placeholder="dd/mm/aaaa"
                [(ngModel)]="nuevoRecordatorioFecha">
              <span class="calendar-icon">ğŸ“…</span>
            </div>
            <button class="btn-add-recordatorio" (click)="agregarRecordatorio()">
              AÃ±adir
            </button>
          </div>
        </div>

        <!-- BotÃ³n para mostrar formulario - Solo si estÃ¡ activo -->
        <button 
          *ngIf="!mostrarFormularioRecordatorio && esViajeActivo()"
          class="btn-show-form-recordatorio" 
          (click)="mostrarFormularioNuevoRecordatorio()">
          <span class="plus-icon">+</span>
          <span>AÃ±adir Recordatorio</span>
        </button>

        <!-- BotÃ³n cancelar si el formulario estÃ¡ visible -->
        <button 
          *ngIf="mostrarFormularioRecordatorio && esViajeActivo()"
          class="btn-cancel-recordatorio" 
          (click)="cancelarRecordatorio()">
          Cancelar
        </button>

        <!-- Mensaje si el viaje estÃ¡ finalizado y no hay recordatorios -->
        <div *ngIf="!esViajeActivo() && viaje.recordatorios.length === 0" class="empty-message-readonly">
          <span class="icon-empty">ğŸ“</span>
          <p>No hay recordatorios registrados para este viaje</p>
        </div>
      </section>
    </main>  

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
      <button class="nav-item" 
              [class.active]="currentTab === 'inicio'"
              (click)="cambiarTab('inicio')">
        <span class="nav-icon">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            <polyline points="9 22 9 12 15 12 15 22"></polyline>
          </svg>
        </span>
        <span class="nav-label">Inicio</span>
      </button>
      
      <button class="nav-item" 
              [class.active]="currentTab === 'explorar'"
              (click)="cambiarTab('explorar')">
        <span class="nav-icon">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
          </svg>
        </span>
        <span class="nav-label">Explorar</span>
      </button>
      
      <button class="nav-item" 
              [class.active]="currentTab === 'viajes'"
              (click)="cambiarTab('viajes')">
        <span class="nav-icon">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
            <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
          </svg>
        </span>
        <span class="nav-label">Viajes</span>
      </button>
      
      <button class="nav-item" 
              [class.active]="currentTab === 'favoritos'"
              (click)="cambiarTab('favoritos')">
        <span class="nav-icon">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
          </svg>
        </span>
        <span class="nav-label">Favoritos</span>
      </button>
      
      <button class="nav-item" 
              [class.active]="currentTab === 'perfil'"
              (click)="cambiarTab('perfil')">
        <span class="nav-icon">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
        </span>
        <span class="nav-label">Perfil</span>
      </button>
    </nav>
  </div>

  <!-- Modal de CalificaciÃ³n -->
  <div class="modal-overlay" *ngIf="mostrarModalCalificacion" (click)="cerrarModalCalificacion()">
    <div class="modal-calificacion" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">Calificar Destino</h2>
        <button class="btn-close-modal" (click)="cerrarModalCalificacion()">âœ•</button>
      </div>

      <div class="modal-body">
        <p class="modal-question">Â¿QuÃ© te pareciÃ³ tu viaje?</p>
        
        <div class="rating-stars">
          <button 
            *ngFor="let estrella of getEstrellas()"
            class="star-btn"
            [class.selected]="estrella <= calificacionSeleccionada"
            (click)="seleccionarCalificacion(estrella)">
            â˜…
          </button>
        </div>

        <div class="form-group">
          <label class="form-label">Escribe tu reseÃ±a aquÃ­...(opcional)</label>
          <textarea 
            class="form-textarea"
            [(ngModel)]="resenaViaje"
            placeholder="Comparte tu experiencia..."
            rows="4"></textarea>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn-guardar-calificacion" (click)="guardarCalificacion()">
          Guardar CalificaciÃ³n
        </button>
      </div>
    </div>
  </div>

  <!-- Modal Compartir Viaje -->
  <div class="modal-overlay" *ngIf="mostrarModalCompartir" (click)="cerrarModalCompartir()">
    <div class="modal-compartir" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">Invitar Amigos</h2>
        <button class="btn-close-modal" (click)="cerrarModalCompartir()">âœ•</button>
      </div>

      <div class="modal-body">
        <p class="modal-subtitle">Comparte este enlace para que tus amigos se unan al viaje</p>
        
        <!-- Enlace de invitaciÃ³n -->
        <div class="link-container">
          <input 
            type="text" 
            class="link-input" 
            [value]="enlaceInvitacion" 
            readonly>
          <button class="btn-copy-link" (click)="copiarEnlace()">
            ğŸ“‹ Copiar
          </button>
        </div>

        <!-- Compartir por email -->
        <div class="email-share-section">
          <h3 class="section-subtitle">Enviar por correo</h3>
          <div class="email-input-group">
            <input 
              type="email" 
              class="email-share-input"
              placeholder="correo@ejemplo.com"
              [(ngModel)]="emailInvitacion">
            <button class="btn-send-email" (click)="compartirPorEmail()">
              âœ‰ï¸ Enviar
            </button>
          </div>
        </div>

        <!-- Compartir por redes sociales -->
        <div class="social-share-section">
          <h3 class="section-subtitle">Compartir en</h3>
          <div class="social-buttons">
            <button class="btn-social whatsapp" (click)="compartirPorWhatsApp()">
              <span class="social-icon">ğŸ’¬</span>
              <span>WhatsApp</span>
            </button>
            <button class="btn-social general" (click)="compartirPorRedes()">
              <span class="social-icon">ğŸ“¤</span>
              <span>MÃ¡s</span>
            </button>
          </div>
        </div>

        <!-- InformaciÃ³n adicional -->
        <div class="info-box-share">
          <p class="info-text-share">
            ğŸ’¡ <strong>Tip:</strong> Las personas que reciban este enlace podrÃ¡n ver y editar el viaje.
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Link Copiado -->
  <div class="modal-notificacion-overlay" *ngIf="mostrarModalLinkCopiado">
    <div class="modal-notificacion success">
      <div class="modal-notificacion-icon">ğŸ“‹</div>
      <h3 class="modal-notificacion-titulo">Â¡Enlace copiado!</h3>
      <p class="modal-notificacion-mensaje">El enlace se ha copiado al portapapeles</p>
    </div>
  </div>

  <!-- Modal Correo Enviado -->
  <div class="modal-notificacion-overlay" *ngIf="mostrarModalCorreoEnviado">
    <div class="modal-notificacion success">
      <div class="modal-notificacion-icon">âœ‰ï¸</div>
      <h3 class="modal-notificacion-titulo">Â¡Correo enviado!</h3>
      <p class="modal-notificacion-mensaje">Se abriÃ³ tu cliente de email para enviar la invitaciÃ³n</p>
    </div>
  </div>

  <!-- Modal Correo InvÃ¡lido -->
  <div class="modal-notificacion-overlay" *ngIf="mostrarModalCorreoInvalido" (click)="cerrarModalCorreoInvalido()">
    <div class="modal-notificacion warning" (click)="$event.stopPropagation()">
      <div class="modal-notificacion-icon">âš ï¸</div>
      <h3 class="modal-notificacion-titulo">AtenciÃ³n</h3>
      <p class="modal-notificacion-mensaje">{{ mensajeCorreoInvalido }}</p>
      <button class="btn-modal-notificacion" (click)="cerrarModalCorreoInvalido()">Entendido</button>
    </div>
  </div>

  <!-- Modal Confirmar Finalizar Viaje -->
  <div class="modal-overlay modal-finalizar-overlay" *ngIf="mostrarModalConfirmarFinalizar" (click)="cancelarFinalizar()">
    <div class="modal-finalizar" (click)="$event.stopPropagation()">
      <div class="finalizar-icon-container">
        <span class="finalizar-emoji">ğŸ</span>
      </div>
      <h2 class="finalizar-title">Â¿Finalizar viaje?</h2>
      <p class="finalizar-viaje-nombre">{{ viaje.icono }} {{ viaje.nombre }}</p>
      <p class="finalizar-text">Al marcar el viaje como finalizado, no podrÃ¡s agregar mÃ¡s destinos, participantes ni recordatorios. PodrÃ¡s calificar tu experiencia.</p>
      <div class="finalizar-buttons">
        <button class="btn-finalizar-cancel" (click)="cancelarFinalizar()" [disabled]="finalizandoViaje">
          Cancelar
        </button>
        <button class="btn-finalizar-confirm" (click)="confirmarFinalizarViaje()" [disabled]="finalizandoViaje">
          <span *ngIf="!finalizandoViaje">SÃ­, finalizar</span>
          <span *ngIf="finalizandoViaje">Finalizando...</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Modal Viaje Finalizado Exitosamente -->
  <div class="modal-notificacion-overlay" *ngIf="mostrarModalViajeFinalizadoExito">
    <div class="modal-notificacion success">
      <div class="modal-notificacion-icon">âœ…</div>
      <h3 class="modal-notificacion-titulo">Â¡Viaje finalizado!</h3>
      <p class="modal-notificacion-mensaje">Tu viaje ha sido marcado como finalizado exitosamente</p>
    </div>
  </div>

  <!-- Modal Gracias por Calificar -->
  <div class="modal-notificacion-overlay" *ngIf="mostrarModalGraciasCalificacion">
    <div class="modal-notificacion success">
      <div class="modal-notificacion-icon">â­</div>
      <h3 class="modal-notificacion-titulo">Â¡Gracias por calificar!</h3>
      <p class="modal-notificacion-mensaje">Tu opiniÃ³n nos ayuda a mejorar</p>
    </div>
  </div>

  <!-- Modal Selecciona CalificaciÃ³n -->
  <div class="modal-notificacion-overlay" *ngIf="mostrarModalSeleccionaCalificacion" (click)="cerrarModalSeleccionaCalificacion()">
    <div class="modal-notificacion warning" (click)="$event.stopPropagation()">
      <div class="modal-notificacion-icon">âš ï¸</div>
      <h3 class="modal-notificacion-titulo">AtenciÃ³n</h3>
      <p class="modal-notificacion-mensaje">Por favor selecciona una calificaciÃ³n</p>
      <button class="btn-modal-notificacion" (click)="cerrarModalSeleccionaCalificacion()">Entendido</button>
    </div>
  </div>

  <!-- Vista de Gastos -->
  <app-trip-expenses
    *ngIf="mostrarGastos"
    [viajeId]="viajeId"
    [nombreViaje]="viaje.nombre"
    [participantes]="viaje.participantes"
    (volver)="volverDeGastos()"
    (navegarATab)="cambiarTab($event)">
  </app-trip-expenses>

  <!-- Vista de Mapa -->
  <app-trip-map
    *ngIf="mostrarMapa"
    [nombreViaje]="viaje.nombre"
    [destinos]="viaje.itinerario"
    (volver)="volverDeMapa()"
    (navegarATab)="cambiarTab($event)">
  </app-trip-map>

  <!-- Modal Agregar Participante -->
  <div class="modal-overlay" *ngIf="mostrarModalAgregarParticipante">
    <div class="modal-content modal-agregar-participante">
      <div class="modal-header">
        <h3>ğŸ‘¥ Agregar Participante</h3>
        <button class="btn-cerrar-modal" (click)="cerrarModalAgregarParticipante()">âœ•</button>
      </div>
      
      <div class="modal-body">
        <p class="modal-descripcion">Ingresa los datos del participante. Se enviarÃ¡ un correo con el enlace de invitaciÃ³n.</p>
        
        <div class="form-group">
          <label class="form-label">Nombre del participante *</label>
          <input 
            type="text" 
            class="form-input"
            [(ngModel)]="nombreNuevoParticipante"
            placeholder="Ej: Juan PÃ©rez"
            [disabled]="enviandoInvitacion">
        </div>

        <div class="form-group">
          <label class="form-label">Correo electrÃ³nico *</label>
          <input 
            type="email" 
            class="form-input"
            [(ngModel)]="emailNuevoParticipante"
            placeholder="correo@ejemplo.com"
            [disabled]="enviandoInvitacion">
        </div>

        <p class="modal-nota">ğŸ“§ El participante recibirÃ¡ un correo con un enlace para unirse al viaje</p>
      </div>

      <div class="modal-actions">
        <button 
          class="btn-cancelar" 
          (click)="cerrarModalAgregarParticipante()"
          [disabled]="enviandoInvitacion">
          Cancelar
        </button>
        <button 
          class="btn-enviar-invitacion" 
          (click)="enviarInvitacionYAgregarParticipante()"
          [disabled]="enviandoInvitacion || !nombreNuevoParticipante.trim() || !emailNuevoParticipante.trim()">
          <span *ngIf="!enviandoInvitacion">ğŸ“¨ Enviar InvitaciÃ³n</span>
          <span *ngIf="enviandoInvitacion">â³ Enviando...</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Modal InvitaciÃ³n Enviada -->
  <div class="modal-overlay" *ngIf="mostrarModalInvitacionEnviada">
    <div class="modal-content modal-success">
      <div class="modal-icon">âœ…</div>
      <h3>Â¡InvitaciÃ³n Enviada!</h3>
      <p>El correo de invitaciÃ³n ha sido enviado exitosamente.</p>
      <p class="modal-nota">El participante aparecerÃ¡ en la lista cuando acepte la invitaciÃ³n.</p>
      <div class="modal-actions">
        <button class="btn-modal-success" (click)="cerrarModalInvitacionEnviada()">Entendido</button>
      </div>
    </div>
  </div>

  <!-- Modal Error InvitaciÃ³n -->
  <div class="modal-overlay" *ngIf="mostrarModalErrorInvitacion">
    <div class="modal-content modal-error">
      <div class="modal-icon">âŒ</div>
      <h3>Error al Enviar</h3>
      <p>{{ mensajeErrorInvitacion }}</p>
      <div class="modal-actions">
        <button class="btn-modal-error" (click)="cerrarModalErrorInvitacion()">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Modal Confirmar Eliminar Participante -->
  <div class="modal-overlay" *ngIf="mostrarModalEliminarParticipante">
    <div class="modal-content modal-warning">
      <div class="modal-icon">âš ï¸</div>
      <h3>Eliminar Participante</h3>
      <p>Â¿EstÃ¡s seguro de que deseas eliminar a <strong>{{ participanteAEliminar?.nombre }}</strong> del viaje?</p>
      <p class="modal-nota">Esta acciÃ³n no se puede deshacer.</p>
      <div class="modal-actions modal-actions-dual">
        <button 
          class="btn-modal-cancel" 
          (click)="cerrarModalEliminarParticipante()"
          [disabled]="eliminandoParticipante">
          Cancelar
        </button>
        <button 
          class="btn-modal-danger" 
          (click)="confirmarEliminarParticipante()"
          [disabled]="eliminandoParticipante">
          {{ eliminandoParticipante ? 'Eliminando...' : 'ğŸ—‘ï¸ Eliminar' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Modal del Mapa con Leaflet -->
  <div class="modal-overlay modal-mapa-overlay" *ngIf="mostrarModalMapa" (click)="cerrarModalMapa()">
    <div class="modal-mapa-container" (click)="$event.stopPropagation()">
      <div class="modal-mapa-header">
        <div class="modal-mapa-info">
          <h3 class="modal-mapa-titulo">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
              <circle cx="12" cy="10" r="3"></circle>
            </svg>
            Mapa del Viaje
          </h3>
          <p class="modal-mapa-subtitulo">{{ viaje.nombre }} - {{ viaje.itinerario.length || 0 }} destinos</p>
        </div>
        <button class="btn-cerrar-mapa" (click)="cerrarModalMapa()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      
      <div id="mapa-viaje-modal" class="mapa-leaflet-container"></div>
      
      <div class="modal-mapa-footer">
        <div class="mapa-leyenda">
          <span class="leyenda-item">
            <span class="leyenda-marker">1</span>
            Los nÃºmeros indican el orden del itinerario
          </span>
        </div>
      </div>
    </div>
  </div>

</div>